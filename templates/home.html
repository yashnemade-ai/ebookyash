<!-- templates/home.html  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-Book Library – Home</title>

  <!-- Google Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',sans-serif;background:#f4f6f9;color:#333}
    a{text-decoration:none;color:inherit} ul{list-style:none}

    /* ───── NAVBAR ───── */
    header{background:#141d33;padding:14px 28px;display:flex;justify-content:space-between;align-items:center}
    .brand{color:#fff;font-size:1.3rem;font-weight:600;display:flex;gap:.4rem}
    nav ul{display:flex;gap:18px}
    .nav-btn{background:#1e2742;color:#fff;padding:8px 22px;border-radius:6px;font-size:.92rem;display:flex;align-items:center;gap:.4rem;transition:.25s}
    .nav-btn:hover{background:#2d3554}

    /* ───── HERO / SEARCH ───── */
    .hero{position:relative;text-align:center;padding:110px 12px 120px}
    .hero h1{font-size:clamp(2rem,4vw,3rem);font-weight:600;margin-bottom:.65rem}
    .hero p{font-size:clamp(.9rem,1.3vw,1.15rem);color:#67718c;margin-bottom:3.5rem}

    .blob,.blob.alt{position:absolute;width:480px;height:480px;border-radius:50%;filter:blur(50px);animation:move 18s linear infinite}
    .blob{background:radial-gradient(circle,rgba(255,113,113,.35),rgba(255,113,113,0)70%);top:50px;left:0}
    .blob.alt{background:radial-gradient(circle,rgba(123,104,238,.32),rgba(123,104,238,0)70%);top:100px;right:0;animation-delay:9s}
    @keyframes move{0%{transform:translateX(0)}50%{transform:translateX(40px)}100%{transform:translateX(0)}}

    .search-bar{width:90%;max-width:730px;margin:0 auto;background:#fff;border-radius:50px;box-shadow:0 12px 30px rgba(0,0,0,.08);padding:6px;display:flex}
    .search-bar input{flex:2;border:none;outline:none;padding:16px 20px;border-radius:50px 0 0 50px;font-size:.95rem}
    .search-bar select{flex:1;border:none;outline:none;padding:0 20px;font-size:.93rem;font-weight:600;appearance:none;background:url("data:image/svg+xml,%3Csvg fill='%23666' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E") right 18px center no-repeat;background-color:#fff}
    .search-bar button{border:none;outline:none;padding:0 34px;display:flex;align-items:center;gap:.45rem;background:#e74c3c;color:#fff;font-weight:600;border-radius:50px;cursor:pointer;transition:.25s}
    .search-bar button:hover{background:#c0392b}

    /* ───── SECTION TITLE ───── */
    .section-title{text-align:center;margin-top:90px}
    .section-title h2{font-size:2rem;font-weight:600;position:relative;padding-bottom:.4rem;color:#111}
    .section-title h2::after{content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:0;width:60px;height:3px;background:#553cdf;border-radius:2px}
    .section-title p{color:#67718c;margin-top:.6rem}

    /* ───── BOOK GRID ───── */
    .category-block{margin-top:60px}
    .cat-heading{font-size:1.45rem;font-weight:600;margin:0 0 24px 12px;color:#1e2742}
    .book-grid{display:grid;gap:34px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));padding:0 16px}
    .book-card{background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 8px 22px rgba(0,0,0,.08);transition:.3s}
    .book-card:hover{transform:translateY(-6px);box-shadow:0 14px 28px rgba(0,0,0,.12)}
    .book-card img{width:100%;height:250px;object-fit:cover}
    .book-body{padding:22px 18px 28px;display:flex;flex-direction:column}
    .book-body h3{font-size:1.1rem;margin-bottom:.55rem;color:#222}
    .book-body p{font-size:.87rem;color:#555;margin-bottom:auto}
    .book-body a{margin-top:18px;color:#553cdf;font-weight:600;font-size:.9rem}

    @media(max-width:600px){
      .search-bar{flex-direction:column;border-radius:24px;padding:10px}
      .search-bar input,.search-bar select,.search-bar button{border-radius:12px;width:100%}
      .search-bar button{margin-top:8px;justify-content:center}
    }
  </style>

  <script>
    // auto-submit when category changes
    function autoSubmit(sel){ sel.form.submit(); }
  </script>
</head>
<body>

<header>
  <div class="brand"><i class="fas fa-book-reader"></i> E-Book Library</div>
  <nav>
    <ul>
      <li><a class="nav-btn" href="{{ url_for('welcome') }}"><i class="fas fa-home"></i> Home</a></li>
      <li><a class="nav-btn" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </nav>
</header>

<section class="hero">
  <span class="blob"></span><span class="blob alt"></span>
  <h1>Discover Your Next Great Read</h1>
  <p>Explore thousands of ebooks across every genre, from bestsellers to hidden gems</p>

  <!-- SEARCH + CATEGORY FILTER -->
  <form class="search-bar" method="get" action="{{ url_for('home') }}">
    <input  type="text" name="q" value="{{ request.args.get('q','') }}" placeholder="Search for books by title…" />
    <select name="category" onchange="autoSubmit(this)">
      <option value="">All Categories</option>
      {% for cat in categories %}
        <option value="{{ cat }}" {{ 'selected' if cat == request.args.get('category') else '' }}>{{ cat }}</option>
      {% endfor %}
    </select>
    <button type="submit"><i class="fas fa-search"></i> Search</button>
  </form>
</section>

{% if not books %}
  <p style="text-align:center;margin:80px 0;font-size:1.2rem;">No books found.</p>
{% else %}
  <!-- GROUPED DISPLAY -->
  {% if request.args.get('q') or request.args.get('category') %}
    <!-- filtered view – show one grid -->
    <div class="section-title"><h2>Results</h2></div>
    <div class="book-grid">
      {% for book in books %}
        <div class="book-card">
          <img src="{{ url_for('static', filename=book.image_url) }}" alt="{{ book.title }}">
          <div class="book-body">
            <h3>{{ book.title }}</h3>
            <p>{{ book.description }}</p>
            <a href="{{ url_for('book_pdf', id=book.id) }}" target="_blank">Read PDF</a>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <!-- default view – show 3 books per category -->
    {% for cat, cat_books in cat_map.items() %}
      <div class="category-block">
        <h3 class="cat-heading">{{ cat }}</h3>
        <div class="book-grid">
          {% for book in cat_books[:3] %}
            <div class="book-card">
              <img src="{{ url_for('static', filename=book.image_url) }}" alt="{{ book.title }}">
              <div class="book-body">
                <h3>{{ book.title }}</h3>
                <p>{{ book.description }}</p>
                <a href="{{ url_for('book_pdf', id=book.id) }}" target="_blank">Read PDF</a>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  {% endif %}
{% endif %}

</body>
</html>
